-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = game.Workspace.CurrentCamera

-- Variables
local espEnabled = false
local aimbotEnabled = false
local menuVisible = true
local aimbotDistance = 500 -- Maximum distance for aimbot to work
local espColor = Color3.fromRGB(255, 0, 0) -- ESP box color

-- Create GUI
local ScreenGui = Instance.new("ScreenGui", game.Players.LocalPlayer:WaitForChild("PlayerGui"))
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 350, 0, 220)
MainFrame.Position = UDim2.new(0.5, -175, 0, 10)
MainFrame.BackgroundTransparency = 0.2
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MainFrame.BorderSizePixel = 0
MainFrame.Visible = menuVisible
MainFrame.ZIndex = 10

-- Create Header
local Header = Instance.new("Frame", MainFrame)
Header.Size = UDim2.new(1, 0, 0.2, 0)
Header.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Header.BorderSizePixel = 0

local Title = Instance.new("TextLabel", Header)
Title.Size = UDim2.new(1, 0, 1, 0)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "Arsenal Cheat Menu"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18

-- Create Buttons
local EspButton = Instance.new("TextButton", MainFrame)
EspButton.Size = UDim2.new(0.8, 0, 0.2, 0)
EspButton.Position = UDim2.new(0.1, 0, 0.25, 0)
EspButton.Text = "ESP: OFF"
EspButton.TextColor3 = Color3.fromRGB(255, 255, 255)
EspButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
EspButton.BorderSizePixel = 1
EspButton.BorderColor3 = Color3.fromRGB(100, 100, 100)
EspButton.Font = Enum.Font.Gotham
EspButton.TextSize = 16

local AimbotButton = Instance.new("TextButton", MainFrame)
AimbotButton.Size = UDim2.new(0.8, 0, 0.2, 0)
AimbotButton.Position = UDim2.new(0.1, 0, 0.55, 0)
AimbotButton.Text = "Aimbot: OFF"
AimbotButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AimbotButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
AimbotButton.BorderSizePixel = 1
AimbotButton.BorderColor3 = Color3.fromRGB(100, 100, 100)
AimbotButton.Font = Enum.Font.Gotham
AimbotButton.TextSize = 16

local AimbotDistanceSlider = Instance.new("TextButton", MainFrame)
AimbotDistanceSlider.Size = UDim2.new(0.8, 0, 0.2, 0)
AimbotDistanceSlider.Position = UDim2.new(0.1, 0, 0.85, 0)
AimbotDistanceSlider.Text = "Aimbot Distance: 500"
AimbotDistanceSlider.TextColor3 = Color3.fromRGB(255, 255, 255)
AimbotDistanceSlider.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
AimbotDistanceSlider.BorderSizePixel = 1
AimbotDistanceSlider.BorderColor3 = Color3.fromRGB(100, 100, 100)
AimbotDistanceSlider.Font = Enum.Font.Gotham
AimbotDistanceSlider.TextSize = 16

-- Functions for ESP and Aimbot
local function isObstructed(origin, target)
    local raycastParams = RaycastParams.new()
    raycastParams.FilterDescendantsInstances = {Players.LocalPlayer.Character, origin.Parent}
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    raycastParams.IgnoreWater = true
    local result = workspace:Raycast(origin.Position, target.Position - origin.Position, raycastParams)
    return result and result.Instance ~= nil
end

local function findClosestVisibleEnemy()
    local closestPlayer, shortestDistance = nil, aimbotDistance
    local myPosition = Camera.CFrame.p
    local localPlayer = Players.LocalPlayer

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer and player.Team ~= localPlayer.Team and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            if not isObstructed(Camera, head) then
                local distance = (head.Position - myPosition).Magnitude
                if distance < shortestDistance then
                    closestPlayer, shortestDistance = player, distance
                end
            end
        end
    end
    return closestPlayer
end

local function createBox(player)
    local head = player.Character:FindFirstChild("Head")
    if not head then return end
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Adornee = head
    billboardGui.Size = UDim2.new(4, 0, 5, 0)
    billboardGui.AlwaysOnTop = true
    billboardGui.StudsOffset = Vector3.new(0, 2, 0)
    billboardGui.Name = "ESP_BillboardGui"

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.BorderSizePixel = 2
    frame.BackgroundTransparency = 1
    frame.BorderColor3 = espColor

    frame.Parent = billboardGui
    billboardGui.Parent = player.Character
end

local function removeBoxes()
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character then
            for _, child in ipairs(player.Character:GetChildren()) do
                if child.Name == "ESP_BillboardGui" then
                    child:Destroy()
                end
            end
        end
    end
end

local function shoot()
    -- This function can be customized based on how the actual shooting is handled
    print("Shooting at the enemy player's head!")
end

local function update()
    if espEnabled then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= Players.LocalPlayer and player.Team ~= Players.LocalPlayer.Team and player.Character then
                if not player.Character:FindFirstChild("ESP_BillboardGui") then
                    createBox(player)
                end
            end
        end
    else
        removeBoxes()
    end

    if aimbotEnabled then
        local closestPlayer = findClosestVisibleEnemy()
        if closestPlayer then
            local head = closestPlayer.Character.Head
            local targetPosition = head.Position
            local cameraLookVector = (targetPosition - Camera.CFrame.p).unit
            local currentLookVector = Camera.CFrame.LookVector

            if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) and cameraLookVector:Dot(currentLookVector) > 0.99 then
                -- Aimbot action
                Camera.CFrame = CFrame.new(Camera.CFrame.p, targetPosition)
                shoot()
            end
        end
    end
end

-- Event for updating the aimbot and ESP
RunService.RenderStepped:Connect(update)

-- Toggle Menu Visibility with Right Shift Key
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightShift then
        menuVisible = not menuVisible
        MainFrame.Visible = menuVisible
    end
end)

-- Button actions
EspButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    EspButton.Text = espEnabled and "ESP: ON" or "ESP: OFF"
end)

AimbotButton.MouseButton1Click:Connect(function()
    aimbotEnabled = not aimbotEnabled
    AimbotButton.Text = aimbotEnabled and "Aimbot: ON" or "Aimbot: OFF"
end)

AimbotDistanceSlider.MouseButton1Click:Connect(function()
    -- Simple click handler to demonstrate interaction; you can implement a slider or input box for the distance
    aimbotDistance = aimbotDistance + 50
    AimbotDistanceSlider.Text = "Aimbot Distance: " .. aimbotDistance
end)

-- Add functionality to adjust the aimbot distance
AimbotDistanceSlider.MouseEnter:Connect(function()
    -- Change background color on hover
    AimbotDistanceSlider.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
end)

AimbotDistanceSlider.MouseLeave:Connect(function()
    -- Reset background color
    AimbotDistanceSlider.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
end)

